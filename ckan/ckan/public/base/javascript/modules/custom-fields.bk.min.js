this.ckan.module('custom-fields',function(jQuery,_){return{options:{fieldSelector:'.control-custom'},initialize:function(){if(!jQuery('html').hasClass('ie7')){jQuery.proxyAll(this,/_on/);var delegated=this.options.fieldSelector+':last input:text:last';this.el.on('change',delegated,this._onChange);this.el.on('keyup',delegated,this._onKeyup);this.el.on('change',':checkbox',this._onRemove);this.$('.checkbox').addClass("btn btn-danger icon-remove");}},newField:function(element){this.el.append(this.cloneField(element));},cloneField:function(current){return this.resetField(jQuery(current).clone());},resetField:function(field){function increment(index,string){return(string||'').replace(/\d+/,function(int){return 1+parseInt(int,10);});}
var input=field.find(':input');if(input.val().match(/^custom-authors-/)){input.each(function(){var inputt=$(this);if(inputt.attr('id').match(/-key$/)){inputt.val(increment).attr('id',increment).attr('name',increment);inputt.data('authorId',inputt.val());inputt.val('');}
else{inputt.val('').attr('id',increment).attr('name',increment);}});}
else{input.val('').attr('id',increment).attr('name',increment);}
var label=field.find('label');label.text(increment).attr('for',increment);return field;},disableField:function(field,disable){field.toggleClass('disabled',disable!==false);},_onChange:function(event){if(event.target.value!==''){var parent=jQuery(event.target).parents(this.options.fieldSelector);this.newField(parent);}},_onRemove:function(event){var parent=jQuery(event.target).parents(this.options.fieldSelector);this.disableField(parent,event.target.checked);},_onKeyup:function(event){var ele=$(event.target);var ele2=ele.prev();if(ele.val()==''){ele2.val('');}
else{ele2.val(ele2.data('authorId'));}}};});